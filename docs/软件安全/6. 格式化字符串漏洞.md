## Format String Vulnerability

### 概述

Printf()用于根据格式打印字符串。第一个参数称为格式字符串。这种格式化打印字符串函数也包括sprintf、fprintf等。攻击者控制第一个format string，从而进行任意地址的读和写。

Format格式指示符![image-20230529133608506](../img/5.25/image-20230529133608506.png)

### 任意地址读

Caller函数的栈被越界访问![image-20230529134728641](../img/5.25/image-20230529134728641.png)

一个例子来了解printf的参数读取![image-20230529135250153](../img/5.25/image-20230529135250153.png)![image-20230529135257600](../img/5.25/image-20230529135257600.png)

### 任意地址写

printf如何修改内存，简而言之，百分号就代表va_list会滑动

![image-20230529141610702](../img/5.25/image-20230529141610702.png)![image-20230529141627977](../img/5.25/image-20230529141627977.png)![image-20230529141635521](../img/5.25/image-20230529141635521.png)![image-20230529141642597](../img/5.25/image-20230529141642597.png)

### 劫持控制流

老师略讲

### 降低风险

![image-20230529142338993](../img/5.25/image-20230529142338993.png)![image-20230529142346620](../img/5.25/image-20230529142346620.png)

## UAF and Type Confusion

### UAF

程序在heap上已经把memory free掉，但是指针的地址还是有效的，再去使用这个指针，就是UAF(Use After Free)。

![image-20230529142842282](../img/5.25/image-20230529142842282.png)

如上例子，我们可以通过buf1悬挂指针来修改buf2或buf3。

![image-20230529143001886](../img/5.25/image-20230529143001886.png)![image-20230529143007131](../img/5.25/image-20230529143007131.png)![image-20230529143259738](../img/5.25/image-20230529143259738.png)

### Double Free

![image-20230529144028910](../img/5.25/image-20230529144028910.png)![image-20230529144048352](../img/5.25/image-20230529144048352.png)

### Type Confusion

向下的类型转换是不安全的，这个主要用在C++中

![image-20230529144322135](../img/5.25/image-20230529144322135.png)

### UAF In Practice

![image-20230529145639675](../img/5.25/image-20230529145639675.png)

![image-20230529145647045](../img/5.25/image-20230529145647045.png)

![image-20230529145654435](../img/5.25/image-20230529145654435.png)
